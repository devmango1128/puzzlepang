import{_ as ae,a as oe,b as ne,c as R,d as ie}from"./B4on_K7-.js";import{u as le,g as V,s as E,_ as ce,a as z,b as F,c as L,d as re,e as C,f as de,h as ue,i as me}from"./DYJwDWjl.js";import{d as ge,J as pe,K as _e,o as ve,L as ye,x as c,y as g,M as he,z as s,A as d,N as u,B as w,O as ke,P as x,Q as be,R as we,S as T,T as A,D as I,U as xe,q as fe,g as f,k as Q,_ as Se}from"./DHQQY5Qe.js";const Me={class:"menu-page"},Pe={class:"title-bar"},ze={class:"app-title"},Ce={class:"title-actions"},Ie={class:"menu-content"},Ue={class:"difficulty-list"},De=["onClick"],qe={class:"diff-left"},$e={key:1},Be={class:"diff-name"},Ne={class:"diff-progress-wrap"},Re={class:"diff-progress"},Ve={class:"diff-progress-text"},Ee={class:"copyright"},Fe=ge({__name:"index",setup(Le){const _=pe(),S=_e(),j=fe().app.baseURL||"",{progress:U,initProgress:G,getDifficultyProgress:h}=le(),{setMuted:D,loadSounds:J,playIntroBgm:q,stopBgm:$}=de(),{t:i,initLocale:K,getDifficultyName:M}=ue(),l=f(!0),v=f({}),y=f([]),O=Q(()=>_.dark.isActive),k=f(!1);function H(){_.dark.toggle(),localStorage.setItem("slidingPuzzle-dark-mode",String(_.dark.isActive))}async function W(){try{const e=await $fetch(`${j}stages.json`);v.value=e}catch(e){console.error("Failed to fetch stage counts:",e)}}const B={normal:{prevId:"easy",percent:50},hard:{prevId:"normal",percent:60},expert:{prevId:"hard",percent:70}};async function X(){const e=await V("unlockedModes");y.value=e||[]}async function N(e){y.value.includes(e)||(y.value.push(e),await E("unlockedModes",[...y.value]))}const Y=Q(()=>me.map((e,n)=>{const a=v.value[e.id]||0,o=h(e.id),p=Math.min(o.currentStage,a||1),t=o.cleared>=a&&a>0;let r=!1,b=0;if(e.id==="easy")r=!1;else if(y.value.includes(e.id))r=!1;else if(e.id==="free"){const m=v.value.easy||0;r=h("easy").cleared<m||m===0,r||N(e.id)}else{const m=B[e.id];if(m){const P=v.value[m.prevId]||0,se=h(m.prevId);b=Math.round(P*m.percent/100),r=se.cleared<b||P===0,r||N(e.id)}}return{...e,totalStages:a,currentStage:a>0?p:1,progressPercent:a>0?Math.floor(o.cleared/a*100):0,isMastered:t,locked:r,requiredStage:b}}));function Z(e,n){if(e.locked){let o="";if(e.id==="free")o=i("unlockFreeMode");else{const p=B[e.id];if(p){const t=M(p.prevId);o=i("unlockRequirement",{mode:t,stage:e.requiredStage})}}_.dialog({title:i("notice"),message:o,ok:{label:i("confirm"),color:"orange",unelevated:!0,class:"dialog-ok-btn"},class:"custom-dialog"});return}if(e.isMastered){S.push(`/game/${e.id}`);return}if(e.id==="free"){S.push(`/game/${e.id}/1`);return}const a=e.totalStages>0?e.currentStage:1;S.push(`/game/${e.id}/${a}`)}function ee(){l.value=!l.value,D(!l.value),U.value.soundEnabled=l.value,l.value?q():$()}ve(async()=>{K();const e=localStorage.getItem("slidingPuzzle-dark-mode");e!==null&&_.dark.set(e==="true"),await G(),await X(),await W(),l.value=U.value.soundEnabled,D(!l.value),J(),l.value&&q(),await te()});async function te(){const e=v.value.easy||0;h("easy").cleared>=e&&e>0&&(await V("freeUnlockPopupShown")||(k.value=!0,await E("freeUnlockPopupShown",!0)))}return ye(()=>{$()}),(e,n)=>{const a=ke,o=xe,p=ie;return c(),g("div",Me,[n[3]||(n[3]=he('<div class="bg-decorations" data-v-1482833a><img src="'+ce+'" class="bg-icon" style="bottom:5%;left:24%;width:100px;animation-delay:0s;" alt="" data-v-1482833a><img src="'+z+'" class="bg-icon" style="bottom:22%;right:20%;width:70px;animation-delay:1.5s;" alt="" data-v-1482833a><img src="'+z+'" class="bg-icon" style="bottom:12%;left:2%;width:40px;animation-delay:1.5s;" alt="" data-v-1482833a><img src="'+z+'" class="bg-icon" style="top:5%;left:2%;width:80px;animation-delay:1.5s;" alt="" data-v-1482833a><img src="'+F+'" class="bg-icon" style="bottom:4%;right:15%;width:45px;animation-delay:0.3s;" alt="" data-v-1482833a><img src="'+F+'" class="bg-icon" style="top:5%;right:15%;width:38px;animation-delay:0.3s;" alt="" data-v-1482833a><img src="'+L+'" class="bg-icon" style="bottom:25%;left:10%;width:56px;animation-delay:0.8s;" alt="" data-v-1482833a><img src="'+L+'" class="bg-icon" style="top:45%;left:18%;width:55px;animation-delay:0.8s;" alt="" data-v-1482833a><img src="'+re+'" class="bg-icon" style="bottom:18%;left:2%;width:90px;animation-delay:1.2s;" alt="" data-v-1482833a><img src="'+ae+'" class="bg-icon" style="bottom:14%;right:8%;width:28px;animation-delay:1.3s;" alt="" data-v-1482833a><img src="'+oe+'" class="bg-icon" style="bottom:28%;left:42%;width:22px;animation-delay:0.3s;" alt="" data-v-1482833a><img src="'+C+'" class="bg-icon" style="top:17%;right:12%;width:12px;animation-delay:1.3s;" alt="" data-v-1482833a><img src="'+C+'" class="bg-icon" style="bottom:10%;right:42%;width:32px;animation-delay:1.3s;" alt="" data-v-1482833a><img src="'+C+'" class="bg-icon" style="top:58%;right:22%;width:22px;animation-delay:1.3s;" alt="" data-v-1482833a><img src="'+ne+'" class="bg-icon" style="bottom:40%;right:15%;width:36px;animation-delay:0.3s;" alt="" data-v-1482833a><img src="'+R+'" class="bg-icon" style="bottom:28%;right:5%;width:16px;animation-delay:2.1s;" alt="" data-v-1482833a><img src="'+R+'" class="bg-icon" style="top:48%;right:24%;width:32px;animation-delay:2.1s;" alt="" data-v-1482833a></div>',1)),s("header",Pe,[n[2]||(n[2]=s("div",{class:"title-spacer"},null,-1)),s("span",ze,d(u(i)("appTitle")),1),s("div",Ce,[w(a,{flat:"",round:"",size:"md",color:"white",icon:O.value?"light_mode":"dark_mode",onClick:H},null,8,["icon"]),w(a,{flat:"",round:"",size:"md",color:"white",icon:l.value?"volume_up":"volume_off",onClick:ee},null,8,["icon"])])]),s("div",Ie,[s("div",Ue,[(c(!0),g(x,null,be(Y.value,(t,r)=>(c(),g("div",{key:t.id,class:we(["difficulty-card",{disabled:t.locked,mastered:t.isMastered}]),onClick:b=>Z(t)},[s("div",qe,[s("div",{class:"diff-icon",style:T({background:t.color,color:["hard","expert"].includes(t.id)?"#333":"#fff"})},[!t.locked&&t.gridSize===0?(c(),A(o,{key:0,name:"casino",size:"24px"})):t.locked?(c(),A(o,{key:2,name:"lock",size:"24px"})):(c(),g("span",$e,d(t.gridSize)+"x"+d(t.gridSize),1))],4),s("div",Be,d(u(M)(t.id)),1)]),s("div",Ne,[s("div",Re,[s("div",{class:"progress-bar",style:T({width:`${t.progressPercent}%`,background:t.color})},null,4)]),s("div",Ve,[t.locked?(c(),g(x,{key:0},[I(d(u(i)("locked")),1)],64)):t.isMastered?(c(),g(x,{key:1},[w(o,{name:"workspace_premium",class:"master-icon"}),I(d(u(i)("mastered")),1)],64)):(c(),g(x,{key:2},[I(d(u(i)("stageFormat",{stage:t.currentStage,percent:t.progressPercent})),1)],64))])])],10,De))),128))])]),s("footer",Ee,d(u(i)("copyright")),1),w(p,{modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=t=>k.value=t),difficulty:"free","mode-name":u(M)("free"),"mode-desc":u(i)("modeDesc.free"),"hide-actions":"",onClose:n[1]||(n[1]=t=>k.value=!1)},null,8,["modelValue","mode-name","mode-desc"])])}}}),Ge=Se(Fe,[["__scopeId","data-v-1482833a"]]);export{Ge as default};
